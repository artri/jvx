-- Copyright 2009 SIB Visions GmbH
--
-- Licensed under the Apache License, Version 2.0 (the "License"); you may not
-- use this file except in compliance with the License. You may obtain a copy of
-- the License at
-- 
-- http://www.apache.org/licenses/LICENSE-2.0
-- 
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-- WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-- License for the specific language governing permissions and limitations under
-- the License.


--
-- Creates a database with following entities:
-- 
-- 
-- Persons (Lookup Tabellen: Salutation, Title) 
-- Companies 
-- Departments 
-- Addresses (Link Table Postcodes, Streets)
--
-- Company has bosses
-- Company has departments
-- Departments have persons
-- Company has general address
-- Department has an address
-- Person has addresses
-- Persons have superiors (Selfjoin)

--------------------------------------------------------------------------------------
-- Stammdaten
--------------------------------------------------------------------------------------

CREATE CACHED TABLE POSTLEITZAHLEN
(
 ID INTEGER IDENTITY,
 PLZ VARCHAR(5) NOT NULL,
 ORT VARCHAR(100) NOT NULL,
 CONSTRAINT UK_POST_PLZ_ORT UNIQUE(PLZ, ORT)
)

CREATE CACHED TABLE STRASSEN
(
 ID INTEGER IDENTITY,
 NAME VARCHAR(200) NOT NULL,
 CONSTRAINT UK_STRA_NAME UNIQUE(NAME)
)

CREATE CACHED TABLE ADRESSEN
(
 ID INTEGER IDENTITY,
 POST_ID INTEGER NOT NULL,
 STRA_ID INTEGER NOT NULL,
 HAUSNUMMER INTEGER NOT NULL,
 STIEGE INTEGER,
 TUERNUMMER INTEGER,
 CONSTRAINT FK_ADRE_POST_ID FOREIGN KEY (POST_ID) REFERENCES POSTLEITZAHLEN (ID),
 CONSTRAINT FK_ADRE_STRA_ID FOREIGN KEY (STRA_ID) REFERENCES STRASSEN (ID)
)

CREATE CACHED TABLE ANREDEN
(
 ID INTEGER IDENTITY,
 BEZEICHNUNG VARCHAR(20) NOT NULL,
 CONSTRAINT UK_ANRE_BEZEICHNUNG UNIQUE(BEZEICHNUNG)
)

CREATE CACHED TABLE TITEL
(
 ID INTEGER IDENTITY,
 BEZEICHNUNG VARCHAR(20) NOT NULL,
 CONSTRAINT UK_TITE_BEZEICHNUNG UNIQUE(BEZEICHNUNG)
)

CREATE CACHED TABLE PERSONEN 
(
 ID INTEGER IDENTITY,
 PERS_ID INTEGER,
 ANRE_ID INTEGER NOT NULL,
 TITE_ID INTEGER,
 ADRE_ID INTEGER,
 VORNAME VARCHAR(100) NOT NULL,
 NACHNAME VARCHAR(100) NOT NULL,
 GEBDAT DATE NOT NULL,
 CONSTRAINT FK_PERS_ANRE_ID FOREIGN KEY (ANRE_ID) REFERENCES ANREDEN (ID),
 CONSTRAINT FK_PERS_TITE_ID FOREIGN KEY (TITE_ID) REFERENCES TITEL (ID),
 CONSTRAINT FK_PERS_PERS_ID FOREIGN KEY (PERS_ID) REFERENCES PERSONEN (ID),
 CONSTRAINT FK_PERS_ADRE_ID FOREIGN KEY (ADRE_ID) REFERENCES ADRESSEN (ID)
)

CREATE CACHED TABLE FIRMEN
(
 ID INTEGER IDENTITY,
 ADRE_ID INTEGER NOT NULL,
 NAME VARCHAR(100) NOT NULL,
 CONSTRAINT UK_FIRM_NAME UNIQUE(NAME),
 CONSTRAINT FK_FIRM_ADRE_ID FOREIGN KEY (ADRE_ID) REFERENCES ADRESSEN (ID)
)

--------------------------------------------------------------------------------------
-- Relations
--------------------------------------------------------------------------------------

CREATE CACHED TABLE FIRM_PERS
(
 ID INTEGER IDENTITY,
 FIRM_ID INTEGER NOT NULL,
 PERS_ID INTEGER NOT NULL,
 CONSTRAINT FK_FIPE_FIRM_ID FOREIGN KEY (FIRM_ID) REFERENCES FIRMEN (ID),
 CONSTRAINT FK_FIPE_PERS_ID FOREIGN KEY (PERS_ID) REFERENCES PERSONEN (ID),
 CONSTRAINT UK_FIPE_FIRM_ID_PERS_ID UNIQUE(FIRM_ID, PERS_ID)
)

CREATE CACHED TABLE ABTEILUNGEN
(
 ID INTEGER IDENTITY,
 FIRM_ID INTEGER NOT NULL,
 ADRE_ID INTEGER,
 BEZEICHNUNG VARCHAR(100),
 CONSTRAINT FK_ABTE_FIRM_ID FOREIGN KEY (FIRM_ID) REFERENCES FIRMEN (ID),
 CONSTRAINT FK_ABTE_ADRE_ID FOREIGN KEY (ADRE_ID) REFERENCES ADRESSEN (ID),
 CONSTRAINT UK_ABTE_FIRM_ID_BEZEICHNUNG UNIQUE(FIRM_ID, BEZEICHNUNG)
)

CREATE CACHED TABLE ABTE_PERS
(
 ID INTEGER IDENTITY,
 ABTE_ID INTEGER NOT NULL,
 PERS_ID INTEGER NOT NULL,
 ABTEILUNGSLEITER CHAR(1) DEFAULT 'Y' NOT NULL,
 CONSTRAINT FK_ABPE_ABTE_ID FOREIGN KEY (ABTE_ID) REFERENCES ABTEILUNGEN (ID),
 CONSTRAINT FK_ABPE_PERS_ID FOREIGN KEY (PERS_ID) REFERENCES PERSONEN (ID),
 CONSTRAINT UK_ABPE_ABTE_ID_PERS_ID UNIQUE(ABTE_ID, PERS_ID)
)
